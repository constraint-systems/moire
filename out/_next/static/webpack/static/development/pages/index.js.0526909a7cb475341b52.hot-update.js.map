{"version":3,"file":"static/webpack/static/development/pages/index.js.0526909a7cb475341b52.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport Head from 'next/head';\n\nfunction getDist(p1, p2) {\n  let a = p2[0] - p1[0];\n  let b = p2[1] - p1[1];\n  return Math.sqrt(a * a + b * b);\n}\n\nlet Home = () => {\n  let canvasRef = useRef();\n  let shipRef = useRef();\n  let requestRef = useRef();\n  let ship_position = useRef([80, 400]);\n  let velocity = useRef([4, 0]);\n  let angle = useRef(0);\n  let keymap = useRef({});\n  let playing = useRef(true);\n  let [help, setHelp] = useState(true);\n\n  function KeyTip(letter) {\n    return (\n      <span\n        className=\"keytip\"\n        onClick={() => {\n          keymap.current[letter] = true;\n          keyAction(letter, false);\n          keymap.current[letter] = false;\n        }}\n        style={{\n          outline: 'solid 1px black',\n          paddingLeft: '0.5ch',\n          paddingRight: '0.5ch',\n          textAlign: 'center',\n          display: 'inline-block',\n          userSelect: 'none',\n          cursor: 'default',\n        }}\n      >\n        {letter === ' ' ? 'spacebar' : letter}\n      </span>\n    );\n  }\n\n  const animate = time => {\n    let dimensions = [window.innerWidth, window.innerHeight];\n\n    let ctx = canvasRef.current.getContext('2d');\n    let stx = shipRef.current.getContext('2d');\n\n    requestRef.current = requestAnimationFrame(animate);\n\n    let pw = 30;\n    let ph = 20;\n\n    let sp = ship_position.current;\n\n    let kc = keymap.current;\n    let a = 0;\n\n    if (kc['d']) {\n      angle.current += 1;\n    }\n    if (kc['a']) {\n      angle.current -= 1;\n    }\n\n    let ac = angle.current;\n    let rad = ac * (Math.PI / 180);\n\n    function pmove(x, y) {\n      ctx.moveTo(Math.round(x + sp[0]), Math.round(y + sp[1]));\n    }\n    function pline(x, y) {\n      ctx.lineTo(Math.round(x + sp[0]), Math.round(y + sp[1]));\n    }\n    function spmove(x, y) {\n      stx.moveTo(x + sp[0], y + sp[1]);\n    }\n    function spline(x, y) {\n      stx.lineTo(x + sp[0], y + sp[1]);\n    }\n\n    function rotate(rad, ox, oy) {\n      return [\n        Math.cos(rad) * ox - Math.sin(rad) * oy,\n        Math.sin(rad) * ox + Math.cos(rad) * oy,\n      ];\n    }\n\n    let vc = velocity.current;\n    let v = vc;\n\n    let mag = Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n    let max = 4;\n    let target = [Math.cos(rad) * max, Math.sin(rad) * max];\n\n    if (kc['w']) {\n      let diff = [target[0] - v[0], target[1] - v[1]];\n      function normalize(v) {\n        return [\n          v[0] / Math.sqrt(v[0] * v[0] + v[1] * v[1]),\n          v[1] / Math.sqrt(v[0] * v[0] + v[1] * v[1]),\n        ];\n      }\n\n      let u = normalize(diff);\n      let dist = getDist(target, vc);\n\n      if (isNaN(dist)) dist = 0;\n      if (isNaN(u[0])) u[0] = 0;\n      if (isNaN(u[1])) u[1] = 0;\n\n      let mult = Math.min(0.1, dist);\n\n      let new_v = [v[0] + u[0] * mult, v[1] + u[1] * mult];\n\n      velocity.current = new_v;\n    }\n\n    let va;\n    if (v[0] > 0) {\n      va = Math.atan(v[1] / v[0]) - Math.PI / 2;\n    } else {\n      va = Math.atan(v[1] / v[0]) + Math.PI / 2;\n    }\n\n    sp[0] += v[0];\n    sp[1] += v[1];\n    if (sp[0] < 0) sp[0] = dimensions[0];\n    if (sp[0] > dimensions[0]) sp[0] = 0;\n    if (sp[1] < 0) sp[1] = dimensions[1];\n    if (sp[1] > dimensions[1]) sp[1] = 0;\n\n    let bend = ((mag / max) * Math.PI) / 4;\n\n    let trail_length =\n      Math.sqrt(dimensions[0] * dimensions[0] + dimensions[1] + dimensions[1]) +\n      20;\n    ctx.beginPath();\n    pmove(...rotate(rad - Math.PI - Math.PI / 8, 0, trail_length));\n    pline(0, 0);\n    pline(...rotate(rad + Math.PI / 8, 0, trail_length));\n    ctx.stroke();\n\n    let debug = false;\n    if (debug) {\n      ctx.beginPath();\n      pmove(0, 0);\n      pline(v[0] * 20, v[1] * 20);\n      ctx.stroke();\n\n      ctx.strokeStyle = 'red';\n      ctx.beginPath();\n      pmove(v[0] * 20, v[1] * 20);\n      pline(0 + target[0] * 20, 0 + target[1] * 20);\n      ctx.stroke();\n\n      ctx.strokeStyle = 'green';\n      ctx.beginPath();\n      pmove(0, 0);\n      // pline(...rotate(rad, 100, 0));\n      pline(0 + target[0] * 20, 0 + target[1] * 20);\n      ctx.stroke();\n\n      ctx.strokeStyle = 'black';\n\n      ctx.beginPath();\n      ctx.arc(sp[0], sp[1], max * 20, 0, 2 * Math.PI);\n      ctx.stroke();\n    }\n\n    ctx.fillStyle = 'black';\n    if (debug && kc['w']) ctx.fillStyle = 'green';\n    stx.clearRect(0, 0, ...dimensions);\n    stx.fillStyle = 'black';\n    stx.beginPath();\n    spmove(...rotate(rad, -pw * (3 / 8), -ph / 2));\n    spline(...rotate(rad, pw / 2, 0));\n    spline(...rotate(rad, -pw * (3 / 8), ph / 2));\n    stx.closePath();\n    stx.fill();\n\n    if (kc['w']) {\n      stx.fillStyle = 'magenta';\n      stx.beginPath();\n      spmove(...rotate(rad, -pw * (3 / 8), -ph / 2));\n      spline(...rotate(rad, -pw * 0.625, 0));\n      spline(...rotate(rad, -pw * (3 / 8), ph / 2));\n      stx.closePath();\n      stx.fill();\n    }\n  };\n\n  function keyAction(letter, repeat) {\n    let c = canvasRef.current;\n    let ctx = c.getContext('2d');\n    if (letter === ' ' && !repeat) {\n      if (playing.current) {\n        cancelAnimationFrame(requestRef.current);\n        playing.current = false;\n      } else {\n        requestRef.current = requestAnimationFrame(animate);\n        playing.current = true;\n      }\n    } else if (letter === 'j' && !repeat) {\n      let link = document.createElement('a');\n\n      var revokeURL = function() {\n        let me = this;\n        requestAnimationFrame(function() {\n          URL.revokeObjectURL(me.href);\n          me.href = null;\n        });\n        this.removeEventListener('click', revokeURL);\n      };\n\n      ctx.canvas.toBlob(function(blob) {\n        link.setAttribute('download', 'moire.png');\n        link.setAttribute('href', URL.createObjectURL(blob));\n        link.addEventListener('click', revokeURL);\n        link.dispatchEvent(\n          new MouseEvent(`click`, {\n            bubbles: true,\n            cancelable: true,\n            view: window,\n          })\n        );\n      });\n    } else if (letter === 'l') {\n      let dimensions = [window.innerWidth, window.innerHeight];\n      ctx.fillStyle = 'white';\n      ctx.fillRect(0, 0, ...dimensions);\n    } else if (letter === '?') {\n      setHelp(prevState => {\n        return !prevState;\n      });\n    }\n  }\n\n  function downHandler(e) {\n    keymap.current[e.key] = true;\n    keyAction(e.key, e.repeat);\n    if (e.key === ' ' && !e.repeat) {\n      e.preventDefault();\n    }\n  }\n\n  function upHandler(e) {\n    keymap.current[e.key] = false;\n  }\n\n  useEffect(() => {\n    let dimensions = [window.innerWidth, window.innerHeight];\n\n    let dpr = window.devicePixelRatio || 1;\n\n    let c = canvasRef.current;\n    let s = shipRef.current;\n\n    c.width = dimensions[0] * dpr;\n    c.height = dimensions[1] * dpr;\n    c.style.width = dimensions[0] + 'px';\n    c.style.height = dimensions[1] + 'px';\n\n    let ctx = canvasRef.current.getContext('2d');\n    ctx.scale(dpr, dpr);\n    ctx.translate(0.5, 0.5);\n\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, ...dimensions);\n\n    ctx.lineWidth = 1;\n\n    s.width = dimensions[0] * dpr;\n    s.height = dimensions[1] * dpr;\n    s.style.width = dimensions[0] + 'px';\n    s.style.height = dimensions[1] + 'px';\n\n    let stx = shipRef.current.getContext('2d');\n    stx.scale(dpr, dpr);\n\n    window.addEventListener('keydown', downHandler);\n    window.addEventListener('keyup', upHandler);\n    requestRef.current = requestAnimationFrame(animate);\n\n    return () => {\n      window.removeEventListener('keydown', downHandler);\n      window.removeEventListener('keyup', upHandler);\n      cancelAnimationFrame(requestRef.current);\n    };\n  }, []);\n\n  return (\n    <div>\n      <Head>\n        <title>Moire</title>\n      </Head>\n      <style jsx global>{`\n        @font-face {\n          font-family: 'custom';\n          src: url('/static/fonts/IBMPlexMono-Regular.woff2') format('woff2'),\n            url('/static/fonts/IBMPlexMono-Regular.woff') format('woff');\n        }\n        * {\n          box-sizing: border-box;\n        }\n        html {\n          font-family: custom, monospace;\n          font-size: 14px;\n          line-height: 1.5;\n        }\n        html.loaded {\n          background: #ddd;\n        }\n        body {\n          margin: 0;\n          overflow: auto;\n        }\n        textarea {\n          font-family: inherit;\n          font-size: inherit;\n          line-height: inherit;\n        }\n        p {\n          margin: 0;\n        }\n        a {\n          color: inherit;\n        }\n      `}</style>\n\n      <div>\n        <canvas\n          style={{ position: 'absolute', left: 0, top: 0 }}\n          ref={canvasRef}\n        />\n        <canvas\n          style={{ position: 'absolute', left: 0, top: 0 }}\n          ref={shipRef}\n        />\n        <div\n          style={{\n            position: 'fixed',\n            outline: 'solid 1px black',\n            display: help ? 'block' : 'none',\n            maxWidth: `calc(100% - 3rem)`,\n            background: 'rgba(255,255,255,0.8)',\n            paddingLeft: '2ch',\n            paddingRight: '2ch',\n            paddingBottom: '1.5rem',\n            paddingTop: '0.75rem',\n            right: '1.5rem',\n            bottom: '1.5rem',\n          }}\n        >\n          <div style={{ marginBottom: '0.75rem', maxWidth: '60ch' }}>\n            Moire lets you generate angular skyscapes using{' '}\n            <a\n              href=\"https://en.wikipedia.org/wiki/Asteroids_(video_game)\"\n              target=\"_blank\"\n            >\n              Asteroids\n            </a>\n            -like ship controls.\n          </div>\n          <div style={{ marginBottom: '0.75rem' }}>Move</div>\n          <div style={{ marginBottom: '0.75rem' }}>\n            {KeyTip('a')} ↪&nbsp; {KeyTip('w')} thrust&nbsp; {KeyTip('d')}{' '}\n            ↩&nbsp;\n          </div>\n          <div style={{ marginBottom: '0.75rem' }}>Special</div>\n          <div style={{ marginBottom: '1.5rem' }}>\n            {KeyTip(' ')} pause&nbsp; {KeyTip('j')} save as png&nbsp;{' '}\n            {KeyTip('l')} clear&nbsp; {KeyTip('?')} help\n          </div>\n          <div>\n            <a\n              href=\"https://github.com/constraint-systems/moire\"\n              target=\"_blank\"\n            >\n              View source↗\n            </a>\n          </div>\n        </div>\n      </div>\n      {help ? null : (\n        <div\n          style={{\n            position: 'fixed',\n            right: '1.5rem',\n            bottom: '1.5rem',\n            background: 'rgba(255,255,255,0.8)',\n          }}\n        >\n          {KeyTip('?')}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Home;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAAA;AAAA;AACA;AAUA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAIA;AACA;AAPA;AAQA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AAsCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;AACA;AACA;AAJA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;;;;A","sourceRoot":""}